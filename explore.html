<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Meta tags from the original document -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>DESIGN DRIVEN RESEARCH</title>
    <meta name="title" content="DESIGN DRIVEN - RESEARCH">
    <meta name="description" content="Design driven research platform for better thesis visualization.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://design-driven.cl/">
    <meta property="og:title" content="DESIGN DRIVEN - RESEARCH">
    <meta property="og:description" content="Design driven research platform for better thesis visualization.">
    <meta property="og:image" content="https://design-driven.cl/path-to-my-image.jpg">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://design-driven.cl/">
    <meta property="twitter:title" content="DESIGN DRIVEN - RESEARCH">
    <meta property="twitter:description" content="Design driven research platform for better thesis visualization.">
    <meta property="twitter:image" content="https://design-driven.cl/path-to-my-image.jpg">

    <!-- CSS and Fonts from the template -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-asterisk' viewBox='0 0 16 16'%3E%3Cpath d='M8 0a1 1 0 0 1 1 1v5.268l4.562-2.634a1 1 0 1 1 1 1.732L10 8l4.562 2.634a1 1 0 1 1-1 1.732L9 9.732V15a1 1 0 1 1-2 0V9.732l-4.562 2.634a1 1 0 1 1-1-1.732L6 8 1.438 5.366a1 1 0 0 1 1-1.732L7 6.268V1a1 1 0 0 1 1-1'/%3E%3C/svg%3E">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-autocolors"></script>

</head>
<body>
    <!-- Navbar section start -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <!-- Left side of the navbar -->
            <a class="navbar-brand" href="#">Memorias de Proyecto de Título de Diseño UC - Nueva Interfaz</a>

            <!-- Right side of the navbar -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="visualize.html">Visualizar</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://diseno.uc.cl/memorias/index.php">Interfaz vieja</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Navbar section end -->

    <!-- Content section start -->

    <!-- Searchbar section start -->

    <input type="text" id="searchInput" class="form-control mb-3" placeholder="Buscar proyectos...">

    <!-- Filter section start (Needs improvement)-->

    <select class="form-select mb-3" id="filterSelect">
        <option selected>Choose a filter...</option>
        <option value="filter1">Filter 1</option>
        <option value="filter2">Filter 2</option>
        <!-- Add more filter options as needed -->
      </select>      

    <!-- Filter section end -->

    <!-- Searchbar section end -->

    <!-- Card section start -->  

    <!-- Container to insert cards dynamically -->
    <div id="cardContainer" class="row">
        <!-- Cards will be generated by JavaScript -->
    </div>
    
    <!-- Card section end -->

    <!-- Modal section start -->

    <div class="modal fade" id="projectModal" tabindex="-1" aria-labelledby="projectModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="projectModalLabel">Project Details</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <!-- Project details go here (To be completed)-->
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

    <!-- Modal section end -->

    <!-- Pagination section start -->

    <nav aria-label="Page navigation">
        <ul class="pagination" id="paginationContainer">
            <!-- Pagination buttons will be generated by JavaScript -->
        </ul>
    </nav>

    <!-- Number of cards per page section start -->

    <div class="d-flex justify-content-end align-items-center mb-3">
        <span class="me-2">Proyectos por página:</span>
        <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownCardsPerPage" data-bs-toggle="dropdown" aria-expanded="false">
            Modificar
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownCardsPerPage">
            <li><button class="dropdown-item" type="button" data-cards="8">8</button></li>
            <li><button class="dropdown-item" type="button" data-cards="16">16</button></li>
            <li><button class="dropdown-item" type="button" data-cards="32">32</button></li>
            <li><button class="dropdown-item" type="button" data-cards="64">64</button></li>
        </ul>
        </div>
    </div>

    <!-- Number of cards per page section end -->

    <!-- Pagination section end -->

    <!-- Content section end -->

    <!-- Footer section start -->
    <footer class="footer bg-dark text-white mt-5 p-3 text-center">
        <div class="container">
            <span>Examen para el curso de Diseño y Nuevos Medios 2023-2 - Nicolás Cruzat</span>
        </div>
    </footer>
    <!-- Footer section end -->

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Scripting section start -->
<script>
    // Global variables
    let allProjects = []; // This will hold all fetched projects
    let currentProjects = []; // This will hold the current page's projects
    let currentPage = 1;
    let projectsPerPage = 8; // Changed 'const' to 'let' to allow reassignment
    
    // Function to replace undefined or null with "s.i."
    function checkValue(value) {
        return value ? value : 's.i.'; // If value is null or undefined, return 's.i.'
    }
    
    // Function to generate a card HTML
    function generateCard(project) {
        // Function to check if a value is null or "s.i." and return an empty string if it is
        function checkValue(value) {
            return value === null || value === "s.i." ? "" : value;
        }

        // Conditional rendering of the PDF link
        const pdfLink = project.nombre_pdf && project.nombre_pdf !== "s.i."
            ? `<a href="https://diseno.uc.cl/memorias/pdf/${project.nombre_pdf}" class="card-link">PDF</a>`
            : "";

        return `
            <div class="col-sm-6 col-md-4 col-lg-3 mb-3"> <!-- Responsive classes for different screen sizes -->
                <div class="card h-100"> <!-- h-100 to make cards of equal height -->
                    <div class="card-body d-flex flex-column"> <!-- flex-column to align the buttons at the bottom -->
                        <h5 class="card-title">${checkValue(project.nombre_proyecto)}</h5>
                        <h6 class="card-subtitle mb-2 text-dark"><strong>(${checkValue(project.year)})</strong></h6>
                        <h6 class="card-subtitle mt-1 mb-2 text-muted"><strong>Autor:</strong> ${checkValue(project.nombre_completo)}</h6>
                        <h6 class="card-subtitle mb-2 text-secondary"><strong>Guía:</strong> ${checkValue(project.nombre_guia)}</h6>
                        <p class="card-text">${checkValue(project.que)}</p>
                        <h6 class="card-subtitle mb-2 text-dark"><strong>Nota:</strong> ${checkValue(project.nota_titulo)}</h6>
                        <div class="mt-auto"> <!-- Aligns the buttons to the bottom -->
                            <button class="btn btn-primary me-1" data-bs-toggle="modal" data-bs-target="#projectModal" onclick="openModal(${project.id})">
                                Ver más
                            </button>
                            ${pdfLink}
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    
    // Update page number when selected on the bar
    function updatePaginationActiveState() {
        const paginationContainer = document.getElementById('paginationContainer');
        const pageButtons = paginationContainer.querySelectorAll('.page-item');
        
        pageButtons.forEach((button, index) => {
            // Skip the first and last item (Previous and Next buttons)
            if(index !== 0 && index !== pageButtons.length - 1) {
                if(parseInt(button.textContent) === currentPage) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            }
        });
    }

    // Function to display projects on a specific page
    function displayProjects(page, data) {
        const startIndex = (page - 1) * projectsPerPage;
        const endIndex = startIndex + projectsPerPage;
        currentProjects = data.slice(startIndex, endIndex);
        
        const cardContainer = document.getElementById('cardContainer');
        cardContainer.innerHTML = ''; // Clear existing cards
        
        currentProjects.forEach(project => {
            cardContainer.innerHTML += generateCard(project); // Append new cards
        });

        updatePaginationActiveState(); // Update the active state of pagination buttons
    }

    // Initialize the modal just once, outside the openModal function
    var myModal = new bootstrap.Modal(document.getElementById('projectModal'));

    // Function to open the modal with more details
    function openModal(projectId) {
        const project = currentProjects.find(p => p.id === projectId); // Find the project data by id
        if (!project) return; // If the project isn't found, exit the function
        
        // Populate the modal with project details
        const modalTitle = document.getElementById('projectModalLabel');
        const modalBody = document.querySelector('#projectModal .modal-body');
        
        modalTitle.textContent = checkValue(project.nombre_proyecto);
        modalBody.innerHTML = `
            <p><strong>Año:</strong> ${checkValue(project.year)}<p>
            <p><strong>Profesor Guía:</strong> ${checkValue(project.nombre_guia)}</p>
            <p><strong>Nota de Título:</strong> ${checkValue(project.nota_titulo)}</p>
            <p><strong>Soporte:</strong> ${checkValue(project.soporte)}</p>
            <p><strong>Ámbito:</strong> ${checkValue(project.ambito)}</p>
            <p><strong>Descripción:</strong> ${checkValue(project.que)}</p>
            <p><strong>Propósito:</strong> ${checkValue(project.para_que)}</p>
            <!-- Additional details can be conditionally rendered if they are not empty -->
        `;
        
        // Show the modal
        myModal.show();
    }
    
    // Fetch JSON data and initialize the page
    function fetchProjects() {
        fetch('https://raw.githubusercontent.com/nicru/design-driven/main/updated_cleansed_data.json')
            .then(response => response.json())
            .then(data => {
                allProjects = data; // Store the fetched data
                initializePagination(allProjects); // Initialize pagination with allProjects
                displayProjects(currentPage, allProjects); // Display the first page of projects
            })
            .catch(error => console.error('Error fetching data:', error));
    }

    // Page change helpter
    function changePage(page) {
        currentPage = page;
        displayProjects(currentPage, allProjects);
        initializePagination(allProjects); // You may need to call this to update the displayed range of page numbers
        updatePaginationActiveState();
    }
 
    // Page change functions
    function changePage(page) {
            currentPage = page;
            displayProjects(currentPage, allProjects);
            initializePagination(allProjects); // You may need to call this to update the displayed range of page numbers
            updatePaginationActiveState();
        }

        function initializePagination(data) {
        const pageCount = Math.ceil(data.length / projectsPerPage);
        const maxPageNumbersToShow = 10;
        const paginationContainer = document.getElementById('paginationContainer');
        
        paginationContainer.innerHTML = ''; // Clear existing pagination buttons

        // Create 'Previous' button
        paginationContainer.innerHTML += `
            <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                <a class="page-link" href="#" aria-label="Previous" onclick="currentPage > 1 && changePage(${currentPage - 1})">&laquo;</a>
            </li>
        `;

        // Determine the range of page numbers to display
        let startPage = Math.max(currentPage - Math.floor(maxPageNumbersToShow / 2), 1);
        let endPage = startPage + maxPageNumbersToShow - 1;

        // Adjust if the end page goes beyond the last page
        if (endPage > pageCount) {
            endPage = pageCount;
            startPage = Math.max(endPage - maxPageNumbersToShow + 1, 1);
        }

        // Add first page and ellipsis if necessary
        if (startPage > 1) {
            paginationContainer.innerHTML += `<li class="page-item"><a class="page-link" href="#" onclick="changePage(1)">1</a></li>`;
            if (startPage > 2) {
                paginationContainer.innerHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
            }
        }

        // Display page numbers
        for (let i = startPage; i <= endPage; i++) {
            paginationContainer.innerHTML += `
                <li class="page-item ${i === currentPage ? 'active' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                </li>
            `;
        }

        // Add last page and ellipsis if necessary
        if (endPage < pageCount) {
            if (endPage < pageCount - 1) {
                paginationContainer.innerHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
            }
            paginationContainer.innerHTML += `<li class="page-item"><a class="page-link" href="#" onclick="changePage(${pageCount})">${pageCount}</a></li>`;
        }

        // Create 'Next' button
        paginationContainer.innerHTML += `
            <li class="page-item ${currentPage === pageCount ? 'disabled' : ''}">
                <a class="page-link" href="#" aria-label="Next" onclick="currentPage < pageCount && changePage(${currentPage + 1})">&raquo;</a>
            </li>
        `;
    }

    // Call fetchProjects on page load
    fetchProjects();
    
    // New code for dropdown to select the number of cards per page
    document.querySelectorAll('.dropdown-menu [data-cards]').forEach(item => {
        item.addEventListener('click', function() {
            projectsPerPage = parseInt(this.getAttribute('data-cards'), 10);
            currentPage = 1; // Reset to the first page
            displayProjects(currentPage, allProjects); // Update the display
            initializePagination(allProjects); // Update the pagination
        });
    });

    </script>
<!-- Scripting section end -->

</body>
</html>
